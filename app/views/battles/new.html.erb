<h2>デッキ編成（最大<%= max_deck_size %>枚まで）</h2>

<%= form_with url: battles_path, method: :post, id: "deck-form" do %>
  <div class="deck-builder">
    <% current_user.user_cards.each do |uc| %>
      <div class="card-option">
        <p><%= image_tag uc.card.image, size: '109x135', class: 'mb-3' %></p>
        <p><%= uc.card.bunya %>（<%= uc.card.effect_type %>: <%= uc.card.power %>）</p>
        <p>所持枚数: <%= uc.quantity %></p>
        <%= number_field_tag "deck[#{uc.card_id}]", 0, in: 0..uc.quantity, class: "deck-input", data: { max: uc.quantity } %>
      </div>
    <% end %>
  </div>

<p id="deck-count">現在の合計枚数: 0 / <%= max_deck_size %></p>

<%= submit_tag "バトル開始！", class: "btn btn-warning", disabled: true, id: "start-battle", data: { max: max_deck_size } %>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const inputs = document.querySelectorAll(".deck-input");
    const counter = document.getElementById("deck-count");
    const submitBtn = document.getElementById("start-battle");
    const maxSize = parseInt(submitBtn.dataset.max);

    function updateCount() {
      let total = 0;
      inputs.forEach(input => {
        total += parseInt(input.value) || 0;
      });
      counter.textContent = `現在の合計枚数: ${total} / ${maxSize}`;

      submitBtn.disabled = total === 0 || total > maxSize;
    }

    inputs.forEach(input => {
      input.addEventListener("input", updateCount);
    });

    updateCount();
  });
</script>
